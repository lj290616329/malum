var msgType = function(msg){
  if(msg==undefined || null==msg||""==msg){
    return "text";
  }
  if(getRegExp("^img.*$").test(msg)){
    return "img";
  }
  if(getRegExp("^file.*$").test(msg)){
    return "file";
  }
  return "text";
};
var fileSrc = function(msg){
  if(msg==undefined || null==msg||""==msg){
    return "";
  }
  return msg.substring(4,msg.indexOf(")"));
};
var imgSrc = function(msg){
  if(msg==undefined || null==msg||""==msg){
    return "";
  }
  return msg.substring(4,msg.indexOf("]"));
};
var formatNumber = function (n) {
  n = n.toString();
  return n[1] ? n : "0" + n
};
var regYear = getRegExp("(y+)", "i");
var dateFormat = function (timestamp, format) {
  if (!format) {
      format = "yyyy-MM-dd hh:mm:ss"
  }
  if (typeof timestamp === "string") {
    var time = getDate(timestamp);
    if(!time || time.toUTCString() == "Invalid Date"){
      return '';
    }
    timestamp = time.getTime();
  }
  timestamp = parseInt(timestamp);
  
  var realDate = getDate(timestamp);
  
  var date = [
      ["M+", formatNumber(realDate.getMonth() + 1)],
      ["d+", formatNumber(realDate.getDate())],
      ["h+", formatNumber(realDate.getHours())],
      ["m+", formatNumber(realDate.getMinutes())],
      ["s+", formatNumber(realDate.getSeconds())],
      ["q+", Math.floor((realDate.getMonth() + 3) / 3)],
      ["S+", realDate.getMilliseconds()],
  ];
  var reg1 = regYear.exec(format);
  if (reg1) {
      format = format.replace(reg1[1], (realDate.getFullYear() + "").substring(4 - reg1[1].length))
  }
  for (var i = 0; i < date.length; i++) {
      var k = date[i][0];
      var v = date[i][1];
      var reg2 = getRegExp("(" + k + ")").exec(format);
      if (reg2) {
          format = format.replace(reg2[1], reg2[1].length == 1 ? v : ("00" + v).substring(("" + v).length))
      }
  }
  return format
};
var ifShow = function(ifneed,result,show){
  if(!ifneed){
    return true;
  }
  if(show){    
    if(result[""+show[0]]!=null && result[""+show[0]].value == show[1]){
      return true;
    }
  }
  return false;
};
var checked = function(result,id,val){
  if(result[""+id]!=null && result[""+id].value!=""){
    var vals = result[""+id].value+'';
    return vals.split(",").indexOf(val)>-1;
  }
  return false;
};
var val = function(result,id){
  if(result[""+id]!=null && result[""+id].value!=""){
    var vals = result[""+id].value+'';
    return vals.split(',')[0];
  }
  return "";
};
module.exports = {
  imgSrc:imgSrc,
  fileSrc:fileSrc,
  msgType:msgType,
  dateFormat:dateFormat,
  ifShow:ifShow,
  checked:checked,
  val:val
};